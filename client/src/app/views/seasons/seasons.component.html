<div class="row">
    <div class="col-lg-3 order-lg-2">
        <div class="bg-gray-dark">
            <select class="form-control" [(ngModel)]="selectedSeasonId" (ngModelChange)="onFilterChange()">
                <option *ngFor="let item of databaseService.allSeasons| keyvalue" [ngValue]="item.key">Season {{getSeasonNumber(item.key)}}</option>
            </select>

            <div class="p-3" *ngIf="selectedSeasonId">
                <h6 class="font-weight-bold">Start at</h6>
                <p>{{databaseService.allSeasons[selectedSeasonId].startAt | date:'YYYY/MM/dd HH:mm'}}</p>

                <h6 class="font-weight-bold">End at</h6>
                <p>{{databaseService.allSeasons[selectedSeasonId].endAt | date:'YYYY/MM/dd HH:mm'}}</p>

                <ng-container *ngIf="shouldShowLastUpdated()">
                    <h6 class="font-weight-bold">Last updated</h6>
                    <p>{{databaseService.allSeasons[selectedSeasonId].lastUpdated | date:'YYYY/MM/dd HH:mm'}}</p>
                </ng-container>

                <ng-container *ngIf="getSeasonNumber(selectedSeasonId) >= 11">
                    <button *ngIf="getSeasonFlourishId()" class="btn btn-primary btn-block" (click)="showChart = !showChart; onFilterChange();">
                        <ng-container *ngIf="!showChart">
                            <i class="fa-solid fa-chart-bar mr-1"></i>
                            Bar Chart Race
                        </ng-container>
                        <ng-container *ngIf="showChart">
                            <i class="fa-solid fa-arrow-left mr-1"></i>
                            Back to table
                        </ng-container>
                    </button>
                </ng-container>
            </div>
        </div>
    </div>

    <div class="col-lg-9 order-lg-1">
        <div class="table-responsive bg-gray-dark" style="max-height: 75vh;">
            <table class="table table-head-fixed table-bordered text-nowrap table-sm table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th style="width: 14px">Rank</th>
                        <th>Guild</th>
                        <th style="width: 100px">
                            <div class="text-center">Level</div>
                        </th>
                        <th style="width: 100px">
                            <div class="text-center">Time left</div>
                        </th>
                    </tr>
                </thead>
                <tbody *ngIf="selectedSeasonId">
                    <tr *ngFor="let leaderboardItem of databaseService.allSeasons[selectedSeasonId]?.leaderboard; index as index;" [routerLink]="'/guilds/' + leaderboardItem.guildNameplate" role="button" [class.text-info]="leaderboardItem.guildNameplate === userGuildTag">
                        <td class="text-center">{{index + 1}}.</td>
                        <td>
                            {{leaderboardItem.guildName}} <span class="font-weight-light h6" style="font-size: 75%;">[{{leaderboardItem.guildNameplate}}]</span>
                        </td>
                        <td>
                            <div class="text-center">{{leaderboardItem.level}}</div>
                        </td>
                        <td class="text-center">
                            {{convertRemainingSec(leaderboardItem.remainingSec)}}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" [class.show]="showChart" [style.display]="showChart ? 'block' : 'none'" style="background-color: rgba(0, 0, 0, 0.6);">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Season {{getSeasonNumber(selectedSeasonId)}}</h4>
                <button type="button" class="close" (click)="showChart = false; onFilterChange();" aria-label="Close">
                    <span>Ã—</span>
                </button>
            </div>
            <div class="modal-body p-0">
                <app-flourish *ngIf="showChart" [url]="getFlourishUrl()"></app-flourish>
            </div>
            <!-- <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" (click)="showChart = false">Close</button>
                <button type="button" class="btn btn-primary" (click)="showChart = false">Continue</button>
            </div> -->
        </div>
    </div>
</div>